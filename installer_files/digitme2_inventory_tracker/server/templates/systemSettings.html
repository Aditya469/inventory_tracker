{#
Copyright 2022 DigitME2

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
#}

{% extends 'base.html' %}

{% block title %}System Settings{% endblock %}

{% block additionalHeadMaterial %}
<script type=text/javascript src="{{ url_for('scripts.getScriptFile', filename='systemSettings.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='common.css')}}">
{% endblock %}

{% block content %}
<div id="contentContainer" class="row mt-2">
    <input type="hidden" id="settingsId">
    <div class="row pb-5 col-sm-8 offset-sm-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4 border borer-dark">
        <div class="" id="backupSettings">
            <h2>Database Backup</h2>
            <label class="col-7 form-check-label" for="dbMakeBackups">Make Automatic Backups</label>
            <input class="col-5 form-check-input align-self-start" id="dbMakeBackups" type="checkbox" onchange="saveSettings()">
            <div class="row col-12">
                <label class="col-7" for="dbBackupAtTime">Automatic Backup Time</label>
                <div class="col-5">
                    <input class="form-control align-self-start" id="dbBackupAtTime" type="time" onchange="saveSettings()">
                </div>
            </div>
            <br>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnMonday">Run on Monday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnMonday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnTuesday">Run on Tuesday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnTuesday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnWednesday">Run on Wednesday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnWednesday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnThursday">Run on Thursday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnThursday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnFriday">Run on Friday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnFriday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnSaturday">Run on Saturday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnSaturday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="dbBackupOnSunday">Run on Sunday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="dbBackupOnSunday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <br>
            <div class="row col-12">
                <label class="col-7" for="dbNumberOfBackups">Number Of Backups To Keep</label>
                <div class="col-5">
                    <input class="form-control align-self-start" id="dbNumberOfBackups" type="number" onchange="saveSettings()">
                </div>
            </div>
            <input id="initiateBackupBtn" type="button" class="col-12 my-2 btn btn-primary" onclick="initiateBackup()" value="Initiate Backup Now">
            <input id="restoreBackupBtn" type="button" class="col-12 my-2 btn btn-secondary" onclick="showRestoreBackupPanel()" value="Restore From Backup...">
            <hr class="col-12">
        </div>
        <div class="" id="stockAutomaticFunctionsSettings">
            <h2>Stock Management Functions</h2>
            <div class="row col-12">
                <label class="col-7" for="stockLevelReorderCheckAtTime">Time to Check For Stock Needing Reorder</label>
                <div class="col-5">
                    <input class="form-control align-self-start" id="stockLevelReorderCheckAtTime" type="time" onchange="saveSettings()">
                </div>
            </div>
            <br>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnMonday">Run on Monday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnMonday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnTuesday">Run on Tuesday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnTuesday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnWednesday">Run on Wednesday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnWednesday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnThursday">Run on Thursday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnThursday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnFriday">Run on Friday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnFriday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnSaturday">Run on Saturday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnSaturday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckOnSunday">Run on Sunday</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckOnSunday" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <br>
            <div class="row col-12">
                <label class="col-7 form-check-label" for="stockCheckAvailableLevels">Check available levels rather than total</label>
                <div class="col-5">
                    <input class="form-check-input align-self-start" id="stockCheckAvailableLevels" type="checkbox" onchange="saveSettings()">
                </div>
            </div>
            <input id="runStockCheckBtn" type="button" class="col-12 my-2 btn btn-primary" onclick="runStockCheck()" value="Run Stock Check Now">
            <hr class="col-12">
        </div>
        <div class="" id="emailSettings">
            <h2>Email Configuration</h2>
            <label class="col-6 form-check-label" for="sendEmails">Send Email Notifications</label>
            <input class="col-6 form-check-input mx-2 align-self-start" id="sendEmails" type="checkbox" onchange="saveSettings()">
            <div class="row col-12">
                <label class="col-6" for="emailSmtpServerName">Email SMPT Server Name</label>
                <div class="col-6 my-1">
                    <input class="form-control align-self-start" id="emailSmtpServerName" type="text" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-6" for="emailSmtpServerPort">Email SMPT Server Port</label>
                <div class="col-6 my-1">
                    <input class="form-control align-self-start" id="emailSmtpServerPort" type="text" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-6" for="emailAccountName">Email Account Name</label>
                <div class="col-6 my-1">
                    <input class="form-control align-self-start" id="emailAccountName" type="text" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-6" for="emailAccountPassword">Email Account Password</label>
                <div class="col-6 my-1">
                    <input class="form-control align-self-start" id="emailAccountPassword" type="text" onchange="saveSettings()">
                </div>
            </div>
            <div class="row col-12">
                <label class="col-6" for="emailSecurityMethod">Email Security Method</label>
                <div class="col-6">
                    <select class="align-self-start form-select" id="emailSecurityMethod" onchange="saveSettings()">
                        <option value="SSL">SSL</option>
                        <option value="TLS">TLS (STARTTLS)</option>
                    </select>
                </div>
            </div>
            <div class="row col-12 pt-2">
                <label class="col-6" for="testEmailRecipientAddress">Send a Test Email to:</label>
                <div class="col-6">
                    <input class="form-control" id="testEmailRecipientAddress" type="text">
                </div>
                <div class="col-6 offset-6 row py-3">
                    <input class="col-12 btn btn-primary" type="button" id="sendTestEmailButton" value="Send Test Email" onclick="sendTestEmail()">
                </div>
            </div>
        </div>
    </div>
</div>
<div id="greyout" hidden class="position-fixed row top-0 start-0 vw-100 vh-100" onclick="closePanels()"></div>
<div id="restoreDbFromBackupPanel" hidden class="container col-sm-8 col-md-6 col-xl-4 h-75 align-middle border bg-body position-absolute top-50 start-50 translate-middle position-fixed">
    <nav id="nav" class="navbar bg-light navbar-light w-100">
        <h2>Restore Database Backup</h2>
        <input class="btn-close" id="closeRestoreDbPanelBtn" type="button" onclick="closePanels()"/>
    </nav>
    <div class="col" id="dbBackupNamesContainer">
        <h3>Available Backups</h3>
        <div id="dbBackupNamesList" minheight="50vh"></div>
    </div>
    <input type="button" class="btn btn-primary my-3" value="Restore Selected Backup" onclick="restoreBackup()">
</div>
{% endblock %}
